<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Running from python · BoreholeNetworksSimulator.jl</title><meta name="title" content="Running from python · BoreholeNetworksSimulator.jl"/><meta property="og:title" content="Running from python · BoreholeNetworksSimulator.jl"/><meta property="twitter:title" content="Running from python · BoreholeNetworksSimulator.jl"/><meta name="description" content="Documentation for BoreholeNetworksSimulator.jl."/><meta property="og:description" content="Documentation for BoreholeNetworksSimulator.jl."/><meta property="twitter:description" content="Documentation for BoreholeNetworksSimulator.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BoreholeNetworksSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../tutorial/">Basic tutorial</a></li><li><a class="tocitem" href="../nonhistory/">Non-history method</a></li><li class="is-active"><a class="tocitem" href>Running from python</a></li></ul></li><li><a class="tocitem" href="../BNSPlots/">Visualizing the result with BNSPlots</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../Braedstrup/">Braedstrup borefield</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Running from python</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Running from python</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/marcbasquensmunoz/BoreholeNetworksSimulator.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/marcbasquensmunoz/BoreholeNetworksSimulator.jl/blob/main/docs/src/python.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-BoreholeNetworksSimulator-from-Python"><a class="docs-heading-anchor" href="#Running-BoreholeNetworksSimulator-from-Python">Running BoreholeNetworksSimulator from Python</a><a id="Running-BoreholeNetworksSimulator-from-Python-1"></a><a class="docs-heading-anchor-permalink" href="#Running-BoreholeNetworksSimulator-from-Python" title="Permalink"></a></h1><p>It is also possible to run BoreholeNetworksSimulator from Python by using its Julia interoperability (achieved with the package <code>PythonCall.jl</code> and the module <code>juliacall</code>) while keeping roughly the same syntax. For a more detailed explanation of how this works, please visit the <a href="https://juliapy.github.io/PythonCall.jl/stable/">PythonCall.jl documentation</a>. This requires to have installed in your python environment the modules <code>juliacall</code> and <code>numpy</code>.</p><p>BoreholeNetworksSimulator.jl contains a second Julia module called <code>BNSPythonAdapter</code> whose purpose is to make the necessary conversions between Python and Julia. This module is not intended to be used from Julia, but from within Python. In this tutorial, we will repeat the example in <a href="../tutorial/#Basic-tutorial">Basic tutorial</a> but run from Python to show how it works. The full example as a Python script in at <code>BNSPythonAdapter/example.py</code>.</p><p>BNSPythonAdapter contains a python script <code>src/adapter.py</code> that executes the necessary bridging code. You should start your python program by importing this module. Assuming that the directory <code>BNSPythonAdapter</code> is added to the <code>sys.path</code>, this should work:</p><pre><code class="nohighlight hljs">import src.adapter</code></pre><p>The script takes care of activating the Julia package <code>BNSPythonAdapter</code> which has <code>BoreholeNetworksSimulator</code> as a dependency, and loads both namespaces for later use. It also defines conversions from Python objects to their Julia counterparts.  Next, we need to import <code>juliacall</code> to be able to reference objects and funcions from <code>BoreholeNetworksSimulator</code>. It is useful to give it an alias for conciseness.</p><pre><code class="nohighlight hljs">from juliacall import Main as jl</code></pre><p>Now, the python variable <code>jl</code> represents the <code>Main</code> module in Julia, and it has as methods all the Julia functions available in it. Since we imported the namespace <code>BoreholeNetworksSimulator</code>, this also includes its objects and functions.</p><p>Then, we define the same variables as in <a href="../tutorial/#Basic-tutorial">Basic tutorial</a>:</p><pre><code class="nohighlight hljs">Δt = 8760*3600/12.
Nt = 10*12

α = 1e-6
λ = 3.
T0 = 10.
medium = jl.GroundMedium(α=α, λ=λ, T0=T0)

D = 10.
H = 100.

borehole = jl.SingleUPipeBorehole(H=H, D=D)

σ = 5.
positions = jl.Array[jl.Tuple[jl.Float64, jl.Float64]]([(0., 0.), (0., σ)])
borefield = jl.EqualBoreholesBorefield(borehole_prototype=borehole, positions=positions)

configurations = [jl.BoreholeNetwork(jl.Vector[jl.Vector[jl.Int]]([[1], [2]]))]

q1 = 5.
q2 = 5.
loads = jl.Array[jl.Float64]([q1, q2])
constraint = jl.constant_HeatLoadConstraint(loads, Nt)

options = jl.SimulationOptions(
    method = jl.ConvolutionMethod(),
    constraint = constraint,
    borefield = borefield,
    medium = medium,
    fluid = jl.Water(),
    Δt = Δt,
    Nt = Nt,
    configurations = configurations
)</code></pre><p>Note that the code itself is not very different from its Julia version, but there are two remarks worth making. First, we need to call any object defined in Julia by typing <code>jl.</code> in front. This creates a python object with the same fields that <code>PythonCall.jl</code> knows how to convert back into a Julia object. Second, note that we have defined the arrays by explicitly declaring their generic type. If we don&#39;t do this, they will be converted into <code>Vector{Any}</code> in the Julia code, which is not desirable.</p><p>Another difference is the definition of our <code>[Operator](@ref)</code> object. Since we are writing python, it should now be a python object with a method <code>operate</code> that returns an object of type <code>jl.BoreholeOperation</code>, which <code>PythonCall.jl</code> knows how to convert to <code>BoreholeOperation</code>. For the ssake of the example, we will implement again the <code>[SimpleOperator](@ref)</code> operator that is already implemented in Julia. For further examples, check the python version of the code for <code>[Example: Braedstrup borefield ](@ref)</code>.</p><pre><code class="nohighlight hljs">class SimpleOperator():
    def __init__(self, mass_flow, branches):
        self.mass_flows = jl.Vector[jl.Float64](mass_flow * np.ones(branches))

    def operate(self, i, options, Tfin, Tfout, Tb, q):
        return jl.BoreholeOperation(options.configurations[0], operator.mass_flows)


operator = SimpleOperator(2., 2)</code></pre><p>Note that this is equivalent to calling the same code from Julia:</p><pre><code class="nohighlight hljs">operator = jl.SimpleOperator(mass_flow = 2., branches = 2)</code></pre><p>Finally we can run the simulation</p><pre><code class="nohighlight hljs">containers = jl.initialize(options)
jl.simulate_b(operator=operator, options=options, containers=containers)</code></pre><p>Note that the bang in <code>simulate!</code> is replaced by a <code>_b</code> in the juliacall version of the function. </p><pre><code class="nohighlight hljs">containers.X</code></pre><p>Now, one can compare this result with its Julia version. If everything went right, they should agree!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../nonhistory/">« Non-history method</a><a class="docs-footer-nextpage" href="../BNSPlots/">Visualizing the result with BNSPlots »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 3 October 2024 13:05">Thursday 3 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
