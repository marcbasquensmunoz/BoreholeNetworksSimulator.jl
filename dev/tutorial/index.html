<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic tutorial · BoreholeNetworksSimulator.jl</title><meta name="title" content="Basic tutorial · BoreholeNetworksSimulator.jl"/><meta property="og:title" content="Basic tutorial · BoreholeNetworksSimulator.jl"/><meta property="twitter:title" content="Basic tutorial · BoreholeNetworksSimulator.jl"/><meta name="description" content="Documentation for BoreholeNetworksSimulator.jl."/><meta property="og:description" content="Documentation for BoreholeNetworksSimulator.jl."/><meta property="twitter:description" content="Documentation for BoreholeNetworksSimulator.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BoreholeNetworksSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Tutorial</span><ul><li class="is-active"><a class="tocitem" href>Basic tutorial</a></li><li><a class="tocitem" href="../nonhistory/">Non-history method</a></li><li><a class="tocitem" href="../python/">Running from python</a></li></ul></li><li><a class="tocitem" href="../BNSPlots/">Visualizing the result with BNSPlots</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../Braedstrup/">Braedstrup borefield</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Basic tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/marcbasquensmunoz/BoreholeNetworksSimulator.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/marcbasquensmunoz/BoreholeNetworksSimulator.jl/blob/main/docs/src/tutorial.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-tutorial"><a class="docs-heading-anchor" href="#Basic-tutorial">Basic tutorial</a><a id="Basic-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-tutorial" title="Permalink"></a></h1><p>In this tutorial we will learn how to simulate the expected temperature and heat extraction in a borehole field.</p><p>First, we need to specify the parameters and constraints of our system, as well as some options for the simulation. This is done through a <a href="../api/#BoreholeNetworksSimulator.SimulationOptions"><code>SimulationOptions</code></a> object. Its variables are modular components with which we can describe many scenarios by leveraging Julia&#39;s multiple dispatch. Let us see the components one by one with an example.</p><p>We start by specifying the simulation time step and the simulation duration. For our example, we will take monthly time steps during 10 years:</p><pre><code class="language-julia hljs">using BoreholeNetworksSimulator

Δt = 8760*3600/12.
Nt = 10*12</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">120</code></pre><p>Suppose the ground we are interested in simulating is made of solid rock. This means the heat transfer will occur by pure conduction. Assume that the thermal diffusivity of the rock is <span>$α = 10^{-6} \frac{m^2}{s}$</span> and its thermal conductivity is <span>$λ = 3 \frac{W}{m \ K}$</span>. The undisturbed temperature of the ground is <span>$T_0=10 \ ^{\circ}C$</span>. We model the ground with a subtype of <a href="../api/#Medium"><code>Medium</code></a>, in our case, as per our assumptions, we are particularly interested in <a href="../api/#BoreholeNetworksSimulator.GroundMedium"><code>GroundMedium</code></a>:</p><pre><code class="language-julia hljs">α = 1e-6
λ = 3.
T0 = 10.
medium = GroundMedium(α=α, λ=λ, T0=T0)


D = 10.
H = 100.
borehole = SingleUPipeBorehole(H=H, D=D)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SingleUPipeBorehole{Float64}
  λg: Float64 2.5
  Cg: Float64 3.1e6
  αg: Float64 8.064516129032258e-7
  rpi: Float64 0.02
  λp: Float64 0.42
  rpo: Float64 0.0223
  dpw: Float64 0.0023
  hp: Float64 725.0
  pipe_position: Tuple{Tuple{Float64, Float64}, Tuple{Float64, Float64}}
  rb: Float64 0.0575
  H: Float64 100.0
  D: Float64 10.0
  n_segments: Int64 1
  R_cache: StaticArraysCore.SMatrix{2, 2, Float64, 4}
  A: StaticArraysCore.MMatrix{2, 2, Float64, 4}
  method: ExponentialUtilities.ExpMethodHigham2005
  exp_cache: Tuple{Vector{StaticArraysCore.MMatrix{2, 2, Float64, 4}}, Vector{Float64}}
</code></pre><p>Next, we need to know how and where the boreholes in our system are. Suppose we are interested in simulating the evolution of two identical vertical boreholes of length <span>$H=100m$</span> and buried at depth <span>$D=10m$</span>, separated by a distance of <span>$σ=5m$</span>. The boreholes are of the U-type. We need to enconde this information in a subtype of <a href="../api/#Borefield"><code>Borefield</code></a>. Since the boreholes in our example have the same properties, we can use <a href="../api/#BoreholeNetworksSimulator.EqualBoreholesBorefield"><code>EqualBoreholesBorefield</code></a>, which instantiates several identical boreholes from a prototype. The prototype is specified by a subtype of <a href="../api/#Borehole"><code>Borehole</code></a>. In our case, we can use <a href="../api/#BoreholeNetworksSimulator.SingleUPipeBorehole"><code>SingleUPipeBorehole</code></a> to model a borehole with a single U-pipe.</p><pre><code class="language-julia hljs">D = 10.
H = 100.

borehole = SingleUPipeBorehole(H=H, D=D)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SingleUPipeBorehole{Float64}
  λg: Float64 2.5
  Cg: Float64 3.1e6
  αg: Float64 8.064516129032258e-7
  rpi: Float64 0.02
  λp: Float64 0.42
  rpo: Float64 0.0223
  dpw: Float64 0.0023
  hp: Float64 725.0
  pipe_position: Tuple{Tuple{Float64, Float64}, Tuple{Float64, Float64}}
  rb: Float64 0.0575
  H: Float64 100.0
  D: Float64 10.0
  n_segments: Int64 1
  R_cache: StaticArraysCore.SMatrix{2, 2, Float64, 4}
  A: StaticArraysCore.MMatrix{2, 2, Float64, 4}
  method: ExponentialUtilities.ExpMethodHigham2005
  exp_cache: Tuple{Vector{StaticArraysCore.MMatrix{2, 2, Float64, 4}}, Vector{Float64}}
</code></pre><p>There are more parameters that are also relevant, such as borehole radius, grout properties, pipe resistance, etc., but for the moment we will use their default values.</p><p>Next, we need to specify where the borehole are located.</p><pre><code class="language-julia hljs">σ = 5.
positions = [(0., 0.), (0., σ)]
borefield = EqualBoreholesBorefield(borehole_prototype=borehole, positions=positions)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">EqualBoreholesBorefield{SingleUPipeBorehole{Float64}, Float64}
  borehole_prototype: SingleUPipeBorehole{Float64}
  positions: Array{Tuple{Float64, Float64}}((2,))
  Nb: Int64 2
</code></pre><p>Note that we didn&#39;t specify yet how the boreholes are connected. This is because the simulation allows for dynamical changes in the network hydraulic configuration. Using different configurations, we can simulate the reverse flow, or even simulate valves opening and closing. The reason behind this design is to allow for decision making on the operation of the borefield <em>during</em> the simulation, based on the inputs that we are interested in.</p><p>For now, let us state the possible hydraulic configurations that we will allows our borefield to be in. This is done with an vector of <a href="../api/#BoreholeNetworksSimulator.BoreholeNetwork"><code>BoreholeNetwork</code></a>. Borefields usually have several branches of boreholes. Each borehole in a branch is connected in series, while branches may o may not be connected in parallel between themselves. To create a <a href="../api/#BoreholeNetworksSimulator.BoreholeNetwork"><code>BoreholeNetwork</code></a>, we need to provide all of its branches in a vector. Each branch is, in turn, a vector containing the identifiers, in order, of the boreholes present in that branch. Each identifier <code>i::Int</code> refers to the borehole located at position <code>positions[i]</code>.</p><p>In our example, we want to simulate two independent boreholes, so each of them must be in a separate branch. Also, for the moment, we are only interested in this configuration, so we define:</p><pre><code class="language-julia hljs">network = all_parallel_network(2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BoreholeNetwork
  graph: Graphs.SimpleGraphs.SimpleDiGraph{Int64}
</code></pre><p>Even with all these specifications, the evolution of the system is still not fully determined. The missing conditions are referred to as constraints, and are modeled by subtypes of <a href="../api/#Constraint"><code>Constraint</code></a>. For instance, if we would like the two boreholes to be connected in parallel, we would still need to impose that their inlet temperatures be equal. In our example, since we want out boreholes to be independent, we will impose the total amount of heat that we want to extract from each borehole. We will impose a constant load, equal for both boreholes. This is specified by</p><pre><code class="language-julia hljs">q1 = H
q2 = H
constraint = constant_HeatLoadConstraint([q1, q2], Nt)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">HeatLoadConstraint{Float64}([100.0 100.0 … 100.0 100.0; 100.0 100.0 … 100.0 100.0])</code></pre><p>We can finally create the object with all the options:</p><pre><code class="language-julia hljs">options = SimulationOptions(
    method = ConvolutionMethod(),
    constraint = constraint,
    borefield = borefield,
    medium = medium,
    fluid = Water(),
    Δt = Δt,
    Nt = Nt,
    configurations = [network]
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SimulationOptions{Float64, Float64, ConvolutionMethod{Float64}, HeatLoadConstraint{Float64}, EqualBoreholesBorefield{SingleUPipeBorehole{Float64}, Float64}, GroundMedium{Float64}, DirichletBoundaryCondition, MeanApproximation, Water}
  method: ConvolutionMethod{Float64}
  constraint: HeatLoadConstraint{Float64}
  borefield: EqualBoreholesBorefield{SingleUPipeBorehole{Float64}, Float64}
  medium: GroundMedium{Float64}
  fluid: Water
  boundary_condition: DirichletBoundaryCondition DirichletBoundaryCondition()
  approximation: MeanApproximation MeanApproximation()
  Δt: Float64 2.628e6
  Nt: Int64 120
  Nb: Int64 2
  Ns: Int64 2
  Ts: Int64 1
  Tmax: Float64 3.1536e8
  t: Array{Float64}((120,)) [2.628e6, 5.256e6, 7.884e6, 1.0512e7, 1.314e7, 1.5768e7, 1.8396e7, 2.1024e7, 2.3652e7, 2.628e7  …  2.91708e8, 2.94336e8, 2.96964e8, 2.99592e8, 3.0222e8, 3.04848e8, 3.07476e8, 3.10104e8, 3.12732e8, 3.1536e8]
  configurations: Array{BoreholeNetwork}((1,))
  atol: Float64 0.0
  rtol: Float64 1.4901161193847656e-8
</code></pre><p>As we have mentioned, the simulation is designed to allow for a controllable opeartion during its duration. We do this by creating a subtype of <a href="../api/#BoreholeNetworksSimulator.Operator"><code>Operator</code></a> containing the operation strategy. Then, we must implement a method of the function <code>operate</code> with our <code>Operator</code> subtype, that takes as an input the current state of the borefield and outputs a <a href="../api/#BoreholeNetworksSimulator.BoreholeOperation"><code>BoreholeOperation</code></a> object. <code>BoreholeOperation</code> has two variables: the first specifies which configuration will be used for the next time step. In our case, we only want a static, simple configuration. The second specifies the mass flow rate through each branch of the selected configuration, provided as a vector. In our example, we will keep this constant through the simulation. For this purpose, there exists the type <a href="../api/#BoreholeNetworksSimulator.ConstantOperator"><code>ConstantOperator</code></a>, that implements precisely this strategy.</p><p>TODO: Update tutorial with new operation and network</p><pre><code class="language-julia hljs">operator = ConstantOperator(network, mass_flows = 2 * ones(2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstantOperator{Float64}
  valves: Dict{Int64, Valve{Float64}}
  mass_flow: Float64 4.0
</code></pre><p>Before simulating, we first need to call <a href="../api/#BoreholeNetworksSimulator.initialize"><code>initialize</code></a> to run some precomputations that will be used throught the simulation and to instantiate containers where the result will be written.</p><pre><code class="language-julia hljs">containers = initialize(options)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SimulationContainers{Float64, Matrix{Float64}}
  M: Array{Float64}((8, 8)) [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
  X: Array{Float64}((8, 120)) [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
  b: Array{Float64}((8,)) [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
  mf: Array{Float64}((2, 120)) [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]
</code></pre><p>And finally, we can start the simulation.</p><pre><code class="language-julia hljs">@time simulate!(operator=operator, options=options, containers=containers)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  0.001235 seconds (10.45 k allocations: 2.323 MiB)</code></pre><p>The simulation is over! Note that the bulk of the time is spent in the precoputation, while the simulation itself is quite fast. This is especially good if we want to test different operation strategies.</p><p>The result is saved in</p><pre><code class="language-julia hljs">containers.X</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8×120 Matrix{Float64}:
 10.2549  10.2763  10.2907  10.3018  …  10.4505  10.4508  10.4512  10.4515
 10.243   10.2644  10.2788  10.2898     10.4385  10.4389  10.4392  10.4395
 10.2549  10.2763  10.2907  10.3018     10.4505  10.4508  10.4512  10.4515
 10.243   10.2644  10.2788  10.2898     10.4385  10.4389  10.4392  10.4395
 10.1984  10.2198  10.2342  10.2453     10.394   10.3943  10.3947  10.395
 10.1984  10.2198  10.2342  10.2453  …  10.394   10.3943  10.3947  10.395
  1.0      1.0      1.0      1.0         1.0      1.0      1.0      1.0
  1.0      1.0      1.0      1.0         1.0      1.0      1.0      1.0</code></pre><p>Each column in <code>containers.X</code> contains the results for a time step. In each column, the first <span>$2 N_b$</span> correspond to the fluid temperatures. In particular, the odd entries <code>containers.X[1:2:2Nb, :]</code> are the inlet temperatures, while the even entries <code>containers.X[2:2:2Nb, :]</code> are the outlet temperatures of each borehole. The next <span>$Nb$</span> values <code>containers.X[2Nb+1:3Nb, :]</code> are the borehole wall temperatures. The last <span>$Nb$</span> values <code>containers.X[3Nb+1:4Nb, :]</code> are the heat extraction of each borehole.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../nonhistory/">Non-history method »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Tuesday 25 March 2025 15:13">Tuesday 25 March 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
